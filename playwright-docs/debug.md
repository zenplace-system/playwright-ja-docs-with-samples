# Playwrightテストのデバッグ

## VS Codeデバッガー

[VS Code拡張機能](/docs/getting-started-vscode)を使用すると、VS Code内で直接テストをデバッグでき、エラーメッセージの確認、ブレークポイントの設定、テストのステップ実行が可能です。

### エラーメッセージ

テストが失敗すると、VS Codeはエディタ内に期待値、実際の値、完全な呼び出しログを含むエラーメッセージを表示します。

### ライブデバッグ

「Show Browser」オプションをチェックしてテストを実行した後、VS Code内のロケーターをクリックすると、ブラウザウィンドウでハイライト表示されます。複数の一致がある場合も表示されます。

VS Code内でロケーターを編集すると、ブラウザウィンドウでリアルタイムに変更が反映されます。

### ロケーターの選択

テストサイドバーから「**Pick locator**」ボタンをクリックし、ブラウザで必要な要素をクリックすると、VS Codeの「Pick locator」ボックスにロケーターが表示されます。Enterキーを押してクリップボードにコピーするか、Escキーを押してキャンセルできます。

Playwrightはページを分析し、[role、text、test id](/docs/locators)を優先した最適なロケーターを見つけます。複数の要素が一致する場合は、ターゲット要素を一意に識別するようにロケーターを改善します。

### デバッグモードでの実行

ブレークポイントを設定するには、ブレークポイントを設定したい行番号の横をクリックして赤い点が表示されるようにします。デバッグモードでテストを実行するには、実行したいテストの行の横を右クリックします。

ブラウザウィンドウが開き、テストが実行され、ブレークポイントが設定された場所で一時停止します。VS Codeのメニューからテストをステップ実行、一時停止、再実行できます。

### 異なるブラウザでのデバッグ

デフォルトでは、デバッグはChromiumプロファイルを使用して行われます。テストサイドバーのデバッグアイコンを右クリックし、ドロップダウンから「Select Default Profile」オプションをクリックすることで、異なるブラウザでテストをデバッグできます。

## Playwright Inspector

Playwright Inspectorは、Playwrightテストのデバッグを支援するGUIツールです。テストのステップ実行、ロケーターのライブ編集、ロケーターの選択、アクション可能性ログの確認ができます。

### デバッグモードでの実行

`--debug`フラグを付けてテストを実行すると、インスペクターが開きます。このフラグを使用すると、以下の設定が自動的に行われます：
- ブラウザがヘッドモードで起動
- デフォルトのタイムアウトが0（タイムアウトなし）に設定

#### すべてのブラウザですべてのテストをデバッグ

```bash
npx playwright test --debug
```

#### 特定のテストをすべてのブラウザでデバッグ

```bash
npx playwright test example.spec.js:10 --debug
```

#### 特定のブラウザでデバッグ

```bash
npx playwright test --project=chromium --debug
```

#### 特定のブラウザで特定のテストをデバッグ

```bash
npx playwright test example.spec.js:10 --project=webkit --debug
```

### テストのステップ実行

インスペクター上部のツールバーを使用して、テストの各アクションを再生、一時停止、ステップ実行できます。現在のアクションはテストコードでハイライト表示され、一致する要素はブラウザウィンドウでハイライト表示されます。

### 特定のブレークポイントからのテスト実行

デバッグプロセスを高速化するには、テストに[page.pause()](/docs/api/class-page#page-pause)メソッドを追加します。これにより、デバッグしたいポイントまでの各アクションをステップ実行する必要がなくなります。

```javascript
await page.pause();
```

`page.pause()`を追加したら、デバッグモードでテストを実行します。インスペクターの「Resume」ボタンをクリックすると、テストが実行され、`page.pause()`でのみ停止します。

### ロケーターのライブ編集

デバッグモードで実行中に、ロケーターをライブ編集できます。「Pick Locator」ボタンの横にあるフィールドには、テストが一時停止しているロケーターが表示されます。このフィールドでロケーターを直接編集でき、一致する要素がブラウザウィンドウでハイライト表示されます。

### ロケーターの選択

デバッグ中に、より堅牢なロケーターを選択する必要がある場合があります。「Pick Locator」ボタンをクリックし、ブラウザウィンドウの任意の要素にホバーします。要素にホバーすると、この要素を特定するために必要なコードが下にハイライト表示されます。ブラウザで要素をクリックすると、ロケーターがフィールドに追加され、調整したりコードにコピーしたりできます。

### アクション可能性ログ

Playwrightがクリックアクションで一時停止すると、すでに実行された[アクション可能性チェック](/docs/actionability)がログに表示されます。これにより、テスト中に何が起こったか、Playwrightが何をしたか、または何をしようとしたかを理解するのに役立ちます。ログには、要素が表示されているか、有効か、安定しているか、ロケーターが要素に解決されたか、ビューにスクロールされたかなどが表示されます。

## Trace Viewer

Playwright [Trace Viewer](/docs/trace-viewer)は、テストの記録されたトレースを探索できるGUIツールです。左側で各アクションを前後に移動でき、アクション中に何が起こっていたかを視覚的に確認できます。画面中央には、アクションのDOMスナップショットが表示されます。右側には、時間、パラメータ、戻り値、ログなどのアクション詳細が表示されます。コンソールメッセージ、ネットワークリクエスト、ソースコードも確認できます。

## ブラウザ開発者ツール

`PWDEBUG=console`でデバッグモードを実行すると、開発者ツールコンソールで`playwright`オブジェクトが利用可能になります。開発者ツールは以下に役立ちます：

- DOMツリーの検査と**要素セレクターの検索**
- 実行中の**コンソールログの確認**
- **ネットワークアクティビティ**やその他の開発者ツール機能の確認

これにより、Playwrightのデフォルトタイムアウトも0（タイムアウトなし）に設定されます。

テストに[page.pause()](/docs/api/class-page#page-pause)メソッドを使用してブレークポイントを設定し、`PWDEBUG=console`でテストを実行します：

```bash
PWDEBUG=console npx playwright test
```

ブラウザウィンドウが起動したら、開発者ツールを開きます。コンソールパネルで`playwright`オブジェクトが利用可能になります。

### 主なコンソールコマンド

- **playwright.$(selector)**: Playwrightセレクターを使用して要素を検索
- **playwright.$$(selector)**: 一致するすべての要素を返す
- **playwright.inspect(selector)**: 要素をElementsパネルで表示
- **playwright.locator(selector)**: ロケーターを作成して一致する要素を検索
- **playwright.selector(element)**: 指定された要素のセレクターを生成

## 詳細なAPIログ

Playwrightは`DEBUG`環境変数を使用した詳細なログをサポートしています：

```bash
DEBUG=pw:api npx playwright test
```

## ヘッドモード

Playwrightはデフォルトでブラウザをヘッドレスモードで実行します。この動作を変更するには、起動オプションとして`headless: false`を使用します。

また、[slowMo](/docs/api/class-browsertype#browser-type-launch-option-slow-mo)オプションを使用して実行を遅くし（操作ごとにN秒）、デバッグ中に追跡することもできます：

```javascript
await chromium.launch({ headless: false, slowMo: 100 });