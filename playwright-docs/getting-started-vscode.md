# はじめに - VS Code

## 概要

Playwright Testはエンドツーエンドテストのニーズに対応するために特別に作成されました。PlaywrightはChromium、WebKit、Firefoxなどのすべての最新レンダリングエンジンをサポートしています。Windows、Linux、macOSでローカルまたはCI上で、ヘッドレスまたはヘッド付きで、AndroidのGoogle ChromeとMobile Safariのネイティブモバイルエミュレーションを使用してテストできます。

Playwrightをインストールしてテストを生成し、実際に動作を確認してみましょう。または[CLI](/docs/intro)を使用してテストを開始・実行することもできます。

## インストール

PlaywrightにはNode.jsでテストする際に利用できるVS Code拡張機能があります。[VS Codeマーケットプレイス](https://marketplace.visualstudio.com/items?itemName=ms-playwright.playwright)またはVS Codeの拡張タブからインストールできます。

インストール後、コマンドパネルを開いて次のように入力します：

```
Install Playwright
```

**Test: Install Playwright**を選択し、テストを実行するブラウザを選択します。これらは後で[playwright.config](/docs/test-configuration)ファイルで設定できます。また、[CIでテストを実行する](/docs/ci-intro)ためのGitHub Actionsセットアップが必要かどうかも選択できます。

### テストサイドバーを開く

テストサイドバーはアクティビティバーのテストアイコンをクリックして開くことができます。これにより、プロジェクト内のすべてのテストを表示するテストエクスプローラーと、プロジェクト、設定、ツール、セットアップを含むPlaywrightサイドバーにアクセスできます。

## テストの実行

テストブロックの横にある緑の三角形をクリックすると、単一のテストを実行できます。Playwrightはテストの各行を実行し、完了するとテストブロックの横に緑のチェックマークと実行にかかった時間が表示されます。

### テストを実行してブラウザを表示する

テストサイドバーで**Show Browsers**オプションを選択することで、ブラウザを表示しながらテストを実行することもできます。テストを実行するために緑の三角形をクリックすると、ブラウザが開き、テストの実行過程を視覚的に確認できます。すべてのテストでブラウザを開いたままにしたい場合はこれを選択したままにし、ヘッドレスモードでブラウザを開かずにテストを実行したい場合はチェックを外します。

**Close all browsers**ボタンを使用して、すべてのブラウザを閉じることができます。

### すべてのテストを表示して実行する

テストサイドバーですべてのテストを表示し、各テストをクリックして展開します。実行されていないテストには緑のチェックマークがありません。テストサイドバーでテストにカーソルを合わせると表示される白い三角形をクリックして、すべてのテストを実行します。

### 複数のブラウザでテストを実行する

Playwrightサイドバーの最初のセクションはプロジェクトセクションです。ここでは、Playwright設定ファイルで定義されたすべてのプロジェクトを確認できます。Playwrightをインストールする際のデフォルト設定では、Chromium、Firefox、WebKitの3つのプロジェクトが提供されます。最初のプロジェクトがデフォルトで選択されています。

複数のプロジェクトでテストを実行するには、プロジェクト名の横にあるチェックボックスをチェックして各プロジェクトを選択します。その後、サイドバーからテストを実行するか、テスト名の横にある再生ボタンを押すと、選択したすべてのプロジェクトでテストが実行されます。

特定のプロジェクトで個別にテストを実行するには、テストのプロジェクト名の横にあるグレーの再生ボタンをクリックします。

### トレースビューワーでテストを実行する

より良い開発者体験のために、**Show Trace Viewer**オプションを使用してテストを実行できます。

これにより、テストの完全なトレースが開き、テストの各アクションをステップ実行したり、タイムライン、ソースコードなどを探索したりできます。

トレースビューワーの詳細については、[トレースビューワーガイド](/docs/trace-viewer)を参照してください。

## テストのデバッグ

VS Code拡張機能を使用すると、VS Code内でテストを直接デバッグし、エラーメッセージを確認し、ブレークポイントを作成し、テストをライブデバッグできます。

### エラーメッセージ

テストが失敗すると、VS Codeはエディタ内に期待値、実際の値、完全な呼び出しログを含むエラーメッセージを表示します。

### ライブデバッグ

`Show Browser`オプションをチェックしてテストを実行した後、VS Code内のロケーターをクリックすると、ブラウザウィンドウでハイライト表示されます。Playwrightは、ロケーターが存在する場合はハイライト表示し、複数の結果がある場合はそれを表示します。

VS Code内でロケーターを編集すると、変更がブラウザウィンドウにリアルタイムで表示されます。

### デバッグモードで実行する

ブレークポイントを設定するには、ブレークポイントを設定したい行番号の横をクリックして赤い点が表示されるようにします。デバッグモードでテストを実行するには、実行したいテストの行の横を右クリックします。

ブラウザウィンドウが開き、テストが実行され、ブレークポイントが設定された場所で一時停止します。VS Codeのメニューからテストをステップ実行、一時停止、再実行できます。

デバッグの詳細については、[Visual Studio Codeでのデバッグ](https://code.visualstudio.com/docs/editor/debugging)を参照してください。

### トレースビューワーでデバッグする

より良い開発者体験のために、**Show Trace Viewer**オプションを使用してテストをデバッグできます。

これにより、テストの完全なトレースが開き、各アクションをステップ実行し、アクションの前後に何が起こったかを確認できます。DOMスナップショットの検査、コンソールログ、ネットワークリクエスト、ソースコードなども確認できます。

トレースビューワーの詳細については、[トレースビューワーガイド](/docs/trace-viewer)を参照してください。

## テストの生成

CodeGenはブラウザで操作を行うとテストを自動生成し、すぐに始めるための優れた方法です。ブラウザウィンドウのビューポートは特定の幅と高さに設定されています。ビューポートを変更したり、異なる環境をエミュレートしたりするには、[設定ガイド](/docs/test-configuration)を参照してください。

### 新しいテストを記録する

テストを記録するには、テストサイドバーから**Record new**ボタンをクリックします。これにより、`test-1.spec.ts`ファイルが作成され、ブラウザウィンドウが開きます。ブラウザでテストしたいURLに移動し、クリックを開始します。Playwrightはあなたの操作を記録し、テストコードを直接VS Codeに生成します。ツールバーのアイコンのいずれかを選択し、ページ上の要素をクリックしてアサーションを生成することもできます。以下のアサーションを生成できます：

* `'assert visibility'` - 要素が表示されていることをアサートする
* `'assert text'` - 要素が特定のテキストを含んでいることをアサートする
* `'assert value'` - 要素が特定の値を持っていることをアサートする

記録が完了したら、**cancel**ボタンをクリックするか、ブラウザウィンドウを閉じます。その後、`test-1.spec.ts`ファイルを検査して、生成されたテストを確認できます。

### カーソル位置から記録する

テストファイルの特定の位置から記録するには、テストサイドバーから**Record at cursor**ボタンをクリックします。これにより、現在のカーソル位置の既存のテストにアクションが生成されます。テストを実行し、カーソルをテストの最後に配置して、テストの生成を続けることができます。

### ロケーターの選択

テストサイドバーから**Pick locator**ボタンをクリックして、[ロケーター](/docs/locators)を選択し、テストファイルにコピーします。次に、ブラウザで必要な要素をクリックすると、VS Codeの**Pick locator**ボックスに表示されます。キーボードの「Enter」を押してロケーターをクリップボードにコピーし、コード内の任意の場所に貼り付けます。または「Escape」を押してキャンセルします。

Playwrightはページを分析し、[role、text、test idロケーター](/docs/locators)を優先して最適なロケーターを見つけます。ジェネレーターがロケーターに一致する複数の要素を見つけた場合、ロケーターを改善してターゲット要素を一意に識別するため、ロケーターによるテスト失敗を心配する必要はありません。

## プロジェクト依存関係

[プロジェクト依存関係](/docs/test-projects)を使用して、他のテストに依存するテストを実行できます。これはWebサイトへのログインなどの**セットアップ**テストに役立ちます。

### セットアップテストの実行

セットアップテストを実行するには、Playwrightサイドバーのプロジェクトセクションから、設定ファイルで定義されている**setup**プロジェクトを選択します。これにより、テストエクスプローラーで**setup**テストにアクセスできます。

**setup**テストに依存するテストを実行すると、最初に**setup**テストが実行されます。テストを実行するたびに、**setup**テストが再度実行されます。

### セットアップテストを一度だけ実行する

**setup**テストを一度だけ実行するには、Playwrightサイドバーのプロジェクトセクションから選択を解除します。これで**setup**テストはテストエクスプローラーから削除されます。**setup**テストに依存するテストを実行すると、**setup**テストは実行されなくなり、はるかに高速になるため、開発者体験が向上します。

## グローバルセットアップ

**グローバルセットアップ**は最初のテストを実行するときに実行されます。一度だけ実行され、データベースのセットアップやサーバーの起動に役立ちます。Playwrightサイドバーの**Setup**セクションから`Run global setup`オプションをクリックして、**グローバルセットアップ**を手動で実行できます。**グローバルティアダウン**はデフォルトでは実行されません。`Run global teardown`オプションをクリックして手動で開始する必要があります。

テストをデバッグすると、グローバルセットアップが再実行されます。これにより、分離された環境とテスト専用のセットアップが確保されます。

## 複数の設定

プロジェクトに複数のPlaywright設定ファイルがある場合、Playwrightサイドバーの右上隅にあるギアアイコンをクリックして切り替えることができます。これにより、プロジェクト内のすべての設定ファイルが表示されます。使用したい設定ファイルの横にあるチェックボックスをチェックし、「OK」ボタンをクリックして選択します。

これで、テストエクスプローラーですべてのテストにアクセスできるようになります。テストを実行するには、ファイルまたはプロジェクト名の横にあるグレーの三角形をクリックします。

すべての設定からすべてのテストを実行するには、テストエクスプローラーの上部にあるグレーの三角形をクリックします。

作業する設定ファイルを選択するには、Playwrightサイドバーの設定ファイル名をクリックして切り替えます。これで、テストの記録などのツールを使用すると、選択した設定ファイル用のテストが記録されます。

Playwrightサイドバーの設定ファイル名をクリックすることで、設定間を簡単に切り替えることができます。

## 次のステップ

* [Webファーストアサーション、ページフィクスチャ、ロケーターを使用してテストを作成する](/docs/writing-tests)
* [CIでテストを実行する](/docs/ci-intro)
* [トレースビューワーの詳細を学ぶ](/docs/trace-viewer)