# ナビゲーション

## 概要

PlaywrightはURLへのナビゲーションやページ操作によって引き起こされるナビゲーションを処理できます。

## 基本的なナビゲーション

最も単純なナビゲーション形式はURLを開くことです：

```javascript
// ページにナビゲート
await page.goto('https://example.com');
```

上記のコードはページを読み込み、Webページが[load](https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event)イベントを発火するのを待ちます。loadイベントは、スタイルシート、スクリプト、iframe、画像などの依存リソースを含むページ全体が読み込まれたときに発火します。

> 注意：`load`イベントの前にページがクライアントサイドリダイレクトを行う場合、[page.goto()](/docs/api/class-page#page-goto)はリダイレクト先のページが`load`イベントを発火するのを待ちます。

## ページはいつ読み込まれたと言えるか？

現代のページは`load`イベントが発火した後も多くの活動を行います。データを遅延取得し、UIを生成し、`load`イベント後に高価なリソース、スクリプト、スタイルを読み込みます。ページが「読み込まれた」と判断する確実な方法はなく、ページ、フレームワークなどによって異なります。では、いつからページと対話を始められるのでしょうか？

Playwrightでは、任意のタイミングでページと対話できます。ターゲット要素が[アクション可能](/docs/actionability)になるのを自動的に待機します。

```javascript
// ナビゲートして要素をクリック
// クリックは要素を自動的に待機します
await page.goto('https://example.com');
await page.getByText('Example Domain').click();
```

上記のシナリオでは、Playwrightはテキストが表示されるのを待ち、その要素に対するアクション可能性チェックが通過するのを待ってからクリックします。

Playwrightは非常に素早いユーザーとして動作します - ボタンが見えた瞬間にクリックします。一般的なケースでは、すべてのリソースが読み込まれたかどうかなどを心配する必要はありません。

## ハイドレーション

ある時点で、Playwrightがアクションを実行しても何も起こらないケースに遭遇するかもしれません。または、入力フィールドにテキストを入力しても消えてしまうことがあります。その最も考えられる理由は、ページの[ハイドレーション](https://en.wikipedia.org/wiki/Hydration_\(web_development\))が不十分なことです。

ページがハイドレーションされる際、まず静的なバージョンのページがブラウザに送信されます。その後、動的な部分が送信され、ページが「ライブ」になります。非常に素早いユーザーとして、Playwrightはページが見えた瞬間に対話を開始します。ページ上のボタンが有効になっていても、リスナーがまだ追加されていない場合、Playwrightは仕事を行いますが、クリックは効果を持ちません。

ページがハイドレーションの問題を抱えているかを確認する簡単な方法は、Chrome DevToolsを開き、ネットワークパネルで「Slow 3G」ネットワークエミュレーションを選択してページをリロードすることです。対象の要素が表示されたら、それと対話してみてください。ボタンクリックが無視されたり、入力したテキストがその後のページ読み込みコードによってリセットされたりするのがわかるでしょう。この問題の適切な解決策は、ハイドレーション後、ページが完全に機能するまで、すべてのインタラクティブなコントロールを無効にしておくことです。

## ナビゲーションの待機

要素をクリックすると複数のナビゲーションがトリガーされる場合があります。このような場合は、明示的に[page.waitForURL()](/docs/api/class-page#page-wait-for-url)を使用して特定のURLを待つことをお勧めします。

```javascript
await page.getByText('Click me').click();
await page.waitForURL('**/login');
```

## ナビゲーションイベント

Playwrightは、ページに新しいドキュメントを表示するプロセスを**ナビゲーション**と**読み込み**に分けています。

**ナビゲーションの開始**はページのURLを変更するか、ページと対話する（リンクをクリックするなど）ことによって行われます。ナビゲーションの意図は、例えば未解決のDNSアドレスに当たった場合にキャンセルされたり、ファイルダウンロードに変換されたりすることがあります。

**ナビゲーションのコミット**はレスポンスヘッダーが解析され、セッション履歴が更新されたときに行われます。ナビゲーションが成功（コミット）した後にのみ、ページはドキュメントの**読み込み**を開始します。

**読み込み**は、残りのレスポンスボディをネットワーク経由で取得し、解析し、スクリプトを実行し、ロードイベントを発火させることをカバーします：

* [page.url()](/docs/api/class-page#page-url)が新しいURLに設定される
* ドキュメントコンテンツがネットワーク経由で読み込まれ、解析される
* [page.on('domcontentloaded')](/docs/api/class-page#page-event-dom-content-loaded)イベントが発火する
* ページがスクリプトを実行し、スタイルシートや画像などのリソースを読み込む
* [page.on('load')](/docs/api/class-page#page-event-load)イベントが発火する
* ページが動的に読み込まれたスクリプトを実行する