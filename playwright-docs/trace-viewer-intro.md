# Playwrightトレースビューアー

## 概要

Playwrightトレースビューアーは、テストの記録されたトレースを探索できるGUIツールです。テストの各アクションを前後に移動し、各アクション中に何が起こっていたかを視覚的に確認できます。

## トレースの記録

デフォルトでは、[playwright.config.js](/docs/trace-viewer#tracing-on-ci)ファイルに各テストの`trace.zip`ファイルを作成するために必要な設定が含まれています。トレースは`on-first-retry`に設定されており、失敗したテストの最初の再試行時に実行されます。また、`retries`はCI上で実行する場合は2、ローカルでは0に設定されています。つまり、トレースは失敗したテストの最初の再試行時に記録されますが、最初の実行時や2回目の再試行時には記録されません。

```javascript
// playwright.config.js
module.exports = {
  retries: process.env.CI ? 2 : 0, // CI上では2に設定
  // ...
  use: {
    trace: 'on-first-retry', // 各テストの最初の再試行時にトレースを記録
  },
};
```

トレースの記録に関する詳細なオプションについては、[トレースビューアー](/docs/trace-viewer)の詳細ガイドをご覧ください。

トレースは通常、継続的インテグレーション（CI）環境で実行されます。ローカルでは、テストの開発とデバッグに[UIモード](/docs/test-ui-mode)を使用できるためです。ただし、[UIモード](/docs/test-ui-mode)を使用せずにローカルでトレースを実行したい場合は、`--trace on`でトレースを強制的にオンにできます。

```bash
npx playwright test --trace on
```

## HTMLレポートの開き方

HTMLレポートでは、実行されたすべてのテストとそれらが実行されたブラウザ、および実行にかかった時間のレポートが表示されます。テストは、合格したテスト、失敗したテスト、不安定なテスト、またはスキップされたテストでフィルタリングできます。特定のテストを検索することもできます。テストをクリックすると詳細ビューが開き、エラー、テストステップ、トレースなどのテストに関する詳細情報を確認できます。

```bash
npx playwright show-report
```

## トレースの開き方

HTMLレポートでは、テスト名ファイル名の横にあるトレースアイコンをクリックすると、必要なテストのトレースが直接開きます。

テストの詳細ビューを開き、「Traces」タブまでスクロールして、トレーススクリーンショットをクリックしてトレースを開くこともできます。

レポーターの詳細については、[HTMLレポーター](/docs/test-reporters#html-reporter)を含むレポーターに関する詳細ガイドをご覧ください。

## トレースの表示

各アクションをクリックしたり、タイムラインを使用してホバーしたりすることで、テストのトレースを表示し、アクションの前後のページの状態を確認できます。テストの各ステップ中のログ、ソース、ネットワーク、エラー、コンソールを検査します。トレースビューアーはDOMスナップショットを作成するため、完全に操作でき、ブラウザのDevToolsを開いてHTML、CSSなどを検査できます。

トレースの詳細については、[トレースビューアー](/docs/trace-viewer)の詳細ガイドをご覧ください。

## 次のステップ

- [GitHub ActionsでCIにテストを実行](/docs/ci-intro)
- [トレースビューアーの詳細](/docs/trace-viewer)